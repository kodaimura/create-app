#!/bin/bash

SH_DIR=$(cd $(dirname $0); pwd)
ROOT_DIR=$(cd $(dirname $0); cd ../; pwd)
TEMPLATE_DIR=$(cd $(dirname $0); cd ../template; pwd)

while true; do
    echo ""
    echo -e "\033[32mPlease enter your Laravel Project Name.\033[0m"
    echo -n ">> "
    read appname
    
    if [ -n "$appname" ]; then
        break
    fi
done

if ! cp -r "$TEMPLATE_DIR/phpat" "$appname"; then
    echo "Failed to copy template. Exiting."
    exit 1
fi

if ! mkdir "$appname/src"; then
    echo "Failed to create src directory. Exiting."
    exit 1
fi

if ! cd "$appname"; then
    echo "Failed to change directory to $appname. Exiting."
    exit 1
fi

echo "Running Docker compose to set up Laravel..."
if docker compose run --rm app composer create-project --prefer-dist laravel/laravel .; then
    echo -e "\033[34mSuccess!!!!!!\033[0m"
else
    echo -e "\033[31mDocker compose failed. Please check the error messages.\033[0m"
    exit 1
fi
